<html>
<head>
    <style>
       #status {
           height: 30px;
           width: 100%;
           color: gray;
           text-align: center;
           font-size: 18pt;
       }
    </style>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="/jquery.cookie.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io.connect('http://codepurple.goshen.edu:9000/game');

        socket.on('status', function (data) {
            $('#status').html("<p>" + data + "</p>");
        });

        socket.on('choice', function (data) {
            $('#msg').html("<p>" + data.msg + "</p>");

            var html = "";
            for (var i=0; i<data.choices.length; i++) {
                html += "<button class='choice' value='" + data.choices[i] + "'>" + data.choices[i]
                    + "</button>";
            }

            $('#choices').html(html);

            $('.choice').click(choice_selected);
        });

        socket.on('authenticate', function (data) {
            if (data.allowed == true) {
                $('#auth').hide();
                $.cookie("auth", data.cookie);
            } else {
                alert('Incorrect username or password. Please try again.');
            }
        });

        function choice_selected() {
            $('#choice').html("<p>" + $(this).val() + "</p>");
            socket.emit('choice', $(this).val());
        }

        function send_authentication() {
            socket.emit('authenticate', {username: $('#username').val()
                                        , password: $('#password').val()
            });

            return false;
        }

        $(document).ready(function () {
            $('#auth_form').submit(send_authentication);

            // @TODO: remove this when production ready
            //socket.emit('authenticate', {cookie: $.cookie('auth')});
        });
    </script>
</head>

<body>
 
<h1>Welcome!</h1>

<div id='status'></div>
<div id='msg'></div>
<div id='choices'></div>
<div id='choice'></div>

<div id='auth'>
    <form id='auth_form' method='post'>
        <label>Username</label><input id='username' type='text' name='username' />
        <br>
        <label>Password</label><input id='password' type='text' name='password' />
        <br>
        <input type='submit' value='Login' />
    </form>
</div>

</body>
</html>
